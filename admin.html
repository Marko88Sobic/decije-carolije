<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - DeÄije ÄŒarolije</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Bubblegum+Sans&display=swap" rel="stylesheet">
    <style>
        /* PostojeÄ‡i CSS ostaje isti, dodajem samo za modal i logo */
        #authModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-content input {
            width: 80%;
            padding: 15px;
            margin: 20px 0;
            border-radius: 15px;
            border: 3px solid #e0e0e0;
        }

        .modal-content button {
            padding: 15px 35px;
            border-radius: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
        }

        .logo {
            max-width: 200px;
            margin: 20px auto;
            display: block;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .logo:hover {
            transform: scale(1.1);
        }

        /* Dodat za loading spinner */
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- NOVO: Modal za autentifikaciju -->
    <div id="authModal">
        <div class="modal-content">
            <h2>ğŸ”’ Unesite Lozinku za Admin</h2>
            <input type="password" id="adminPassword" placeholder="Lozinka">
            <button onclick="checkPassword()">OtkljuÄaj</button>
            <p id="errorMsg" style="color: red; margin-top: 10px;"></p>
        </div>
    </div>

    <div class="container" id="adminContent" style="display: none;">
        <header>
            <h1>ğŸ”§ Admin Panel</h1>
            <p class="subtitle">Upravljaj videom i zadacima za decu</p>
            <!-- NOVO: Logo YT kanala -->
            <a href="https://www.youtube.com/channel/tvoj-kanal-id" target="_blank">
                <img src="https://tvoj-yt-logo-url.com/logo.png" alt="Logo YT Kanala" class="logo">
            </a>
        </header>

        <div class="nav-buttons">
            <a href="index.html" class="btn btn-secondary">ğŸ  PoÄetna</a>
            <a href="dnevni-izazovi.html" class="btn btn-secondary">ğŸ“º Vidi Rezultat</a>
        </div>

        <div class="success-message" id="successMessage">
            âœ… UspeÅ¡no saÄuvano! Promena je odmah aktivna.
        </div>

        <!-- VIDEO SEKCIJA -->
        <div class="admin-card">
            <h2>ğŸ“º Postavi Dnevni Video</h2>
            
            <div class="current-data" id="currentVideoData">
                <h3>Trenutni video:</h3>
                <p id="currentVideoInfo">Nije postavljen</p>
            </div>

            <div class="form-group">
                <label>YouTube Link ili Video ID:</label>
                <input type="text" id="videoInput" placeholder="Npr: https://www.youtube.com/watch?v=ABC123 ili samo ABC123">
                <p class="help-text">ğŸ’¡ MoÅ¾ete nalepiti ceo link ili samo ID videa</p>
            </div>

            <div class="example-box">
                <strong>Primeri:</strong><br>
                â€¢ Ceo link: https://www.youtube.com/watch?v=dQw4w9WgXcQ<br>
                â€¢ Samo ID: dQw4w9WgXcQ<br>
                â€¢ Kratak link: https://youtu.be/dQw4w9WgXcQ
            </div>

            <div class="preview-section">
                <h3>ğŸ‘ï¸ Pregled:</h3>
                <div class="video-preview" id="videoPreview">
                    Unesite video link za pregled
                </div>
            </div>

            <button class="btn" onclick="saveVideo()">ğŸ’¾ SaÄuvaj Video</button>
        </div>

        <!-- ZADACI SEKCIJA -->
        <div class="admin-card">
            <h2>ğŸ“ Postavi Dnevne Zadatke</h2>
            
            <div class="current-data">
                <h3>Trenutni zadaci:</h3>
                <ul id="currentTasksList" style="list-style: none; padding-left: 0;">
                    <li style="padding: 5px 0;">UÄitavanje...</li>
                </ul>
            </div>

            <div class="form-group">
                <label>Zadaci (jedan po liniji):</label>
                <textarea id="tasksInput" rows="6" placeholder="Nacrtaj svoj omiljeni lik iz priÄe
Smisli nastavak priÄe
Napravi kolaÅ¾ od papira
UÄi pesmu iz videa"></textarea>
                <p class="help-text">ğŸ’¡ Svaki zadatak u novom redu (max 10 zadataka)</p>
            </div>

            <button class="btn" onclick="saveTasks()">ğŸ’¾ SaÄuvaj Zadatke</button>
        </div>

        <!-- NASLOV IZAZOVA -->
        <div class="admin-card">
            <h2>ğŸ¯ Postavi Naslov Izazova</h2>
            
            <div class="form-group">
                <label>Naslov danaÅ¡njeg izazova:</label>
                <input type="text" id="challengeTitle" placeholder="Npr: Nacrtaj Äarobnu Å¡umu">
                <p class="help-text">ğŸ’¡ Prikazuje se ispod videa</p>
            </div>

            <div class="form-group">
                <label>Opis izazova:</label>
                <textarea id="challengeDescription" rows="3" placeholder="Pogledaj video i uradi sledeÄ‡e aktivnosti sa nama!"></textarea>
            </div>

            <button class="btn" onclick="saveChallenge()">ğŸ’¾ SaÄuvaj Naslov i Opis</button>
        </div>

        <!-- RESET SEKCIJA -->
        <div class="admin-card">
            <h2>âš ï¸ Reset Opcije</h2>
            
            <p style="margin-bottom: 20px; color: #666;">PaÅ¾ljivo koristite ove opcije!</p>
            
            <button class="btn btn-danger" onclick="resetAllUserData()">ğŸ—‘ï¸ ObriÅ¡i Sve Korisnike</button>
            <button class="btn btn-danger" onclick="resetDailyProgress()">ğŸ”„ Resetuj Dnevni Progres</button>
            
            <p class="help-text" style="margin-top: 15px;">
                âš ï¸ "ObriÅ¡i Sve Korisnike" - briÅ¡e sve profile dece i njihove rezultate<br>
                âš ï¸ "Resetuj Dnevni Progres" - briÅ¡e samo Äekirane zadatke za danaÅ¡nji dan
            </p>
        </div>
    </div>

    <script>
        // NOVO: Lozinka za admin (promeni po potrebi)
        const ADMIN_PASSWORD = 'admin123';

        // Proveri lozinku
        function checkPassword() {
            const input = document.getElementById('adminPassword').value;
            if (input === ADMIN_PASSWORD) {
                document.getElementById('authModal').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadCurrentData(); // UÄitaj podatke nakon otkljuÄavanja
            } else {
                document.getElementById('errorMsg').textContent = 'âŒ PogreÅ¡na lozinka!';
            }
        }

        // Enter key za lozinku
        document.getElementById('adminPassword').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        });

        // UÄitaj trenutne podatke
        function loadCurrentData() {
            try {
                // NOVO: Dodaj loading
                document.getElementById('currentTasksList').innerHTML = '<div class="loading">UÄitavanje...</div>';

                // UÄitaj video
                const videoId = localStorage.getItem('dailyVideoId');
                if (videoId) {
                    document.getElementById('videoInput').value = videoId;
                    document.getElementById('currentVideoInfo').innerHTML = 
                        `Video ID: <strong>${videoId}</strong><br>
                        <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">Otvori na YouTube-u</a>`;
                    updateVideoPreview();
                }

                // UÄitaj zadatke
                const tasks = JSON.parse(localStorage.getItem('dailyTasks') || '[]');
                if (tasks.length > 0) {
                    document.getElementById('tasksInput').value = tasks.join('\n');
                    
                    const tasksList = document.getElementById('currentTasksList');
                    tasksList.innerHTML = '';
                    tasks.forEach(task => {
                        const li = document.createElement('li');
                        li.style.padding = '10px 0'; // PoboljÅ¡ano formatiranje
                        li.innerHTML = 'âœ¨ ' + task;
                        tasksList.appendChild(li);
                    });
                } else {
                    document.getElementById('currentTasksList').innerHTML = '<li style="padding: 5px 0;">Nema zadataka</li>';
                }

                // UÄitaj izazov
                const title = localStorage.getItem('challengeTitle');
                const description = localStorage.getItem('challengeDescription');
                if (title) document.getElementById('challengeTitle').value = title;
                if (description) document.getElementById('challengeDescription').value = description;
            } catch (error) {
                alert('âŒ GreÅ¡ka pri uÄitavanju podataka: ' + error.message);
            }
        }

        // NOVO: Bolja validacija za video ID
        function extractVideoId(input) {
            input = input.trim();
            
            // Ako je veÄ‡ samo ID (11 karaktera, alfanumeriÄki sa - i _)
            if (/^[a-zA-Z0-9_-]{11}$/.test(input)) {
                return input;
            }
            
            // YouTube standardni link: youtube.com/watch?v=ID
            let match = input.match(/[?&]v=([^&]+)/);
            if (match && /^[a-zA-Z0-9_-]{11}$/.test(match[1])) return match[1];
            
            // YouTube kratki link: youtu.be/ID
            match = input.match(/youtu\.be\/([^?]+)/);
            if (match && /^[a-zA-Z0-9_-]{11}$/.test(match[1])) return match[1];
            
            // Embed link: youtube.com/embed/ID
            match = input.match(/embed\/([^?]+)/);
            if (match && /^[a-zA-Z0-9_-]{11}$/.test(match[1])) return match[1];
            
            return null; // Vrati null ako nije validno
        }

        function updateVideoPreview() {
            const input = document.getElementById('videoInput').value;
            const videoId = extractVideoId(input);
            const preview = document.getElementById('videoPreview');
            
            if (videoId) {
                preview.innerHTML = `
                    <iframe 
                        src="https://www.youtube.com/embed/${videoId}" 
                        allowfullscreen
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                    </iframe>
                `;
            } else {
                preview.innerHTML = 'Unesite ispravan video link';
            }
        }

        function saveVideo() {
            const input = document.getElementById('videoInput').value;
            const videoId = extractVideoId(input);
            
            if (!videoId) {
                alert('âŒ Molim vas unesite ispravan YouTube link ili video ID (11 karaktera)!');
                return;
            }
            
            localStorage.setItem('dailyVideoId', videoId);
            showSuccess();
            loadCurrentData();
        }

        function saveTasks() {
            const tasksText = document.getElementById('tasksInput').value;
            const tasks = tasksText.split('\n').filter(task => task.trim() !== '');
            
            if (tasks.length === 0) {
                alert('âŒ Molim vas unesite bar jedan zadatak!');
                return;
            }
            if (tasks.length > 10) { // NOVO: Limit
                alert('âŒ Maksimalno 10 zadataka!');
                return;
            }
            
            localStorage.setItem('dailyTasks', JSON.stringify(tasks));
            
            // Reset completed tasks
            localStorage.removeItem('completedTasks');
            
            showSuccess();
            loadCurrentData();
        }

        function saveChallenge() {
            const title = document.getElementById('challengeTitle').value;
            const description = document.getElementById('challengeDescription').value;
            
            if (!title.trim()) {
                alert('âŒ Molim vas unesite naslov izazova!');
                return;
            }
            
            localStorage.setItem('challengeTitle', title);
            localStorage.setItem('challengeDescription', description || 'Pogledaj video i uradi sledeÄ‡e aktivnosti sa nama!');
            
            showSuccess();
        }

        function showSuccess() {
            const msg = document.getElementById('successMessage');
            msg.style.display = 'block';
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        function resetAllUserData() {
            if (confirm('âš ï¸ Da li ste SIGURNI da Å¾elite da obriÅ¡ete SVE korisnike i njihove rezultate?\n\nOvo NE MOÅ½E da se poniÅ¡ti!')) {
                if (confirm('âš ï¸ POSLEDNJE UPOZORENJE!\n\nOvim Ä‡ete obrisati:\n- Sve profile dece\n- Sve poene i zvezdice\n- Sve statistike\n\nNastavi?')) {
                    localStorage.removeItem('allUsers');
                    localStorage.removeItem('currentUser');
                    alert('âœ… Svi korisniÄki podaci su obrisani!');
                }
            }
        }

        function resetDailyProgress() {
            if (localStorage.getItem('completedTasks') && confirm('Da li Å¾elite da resetujete dnevni progres (Äekirane zadatke)?')) {
                localStorage.removeItem('completedTasks');
                alert('âœ… Dnevni progres je resetovan!');
            } else if (!localStorage.getItem('completedTasks')) {
                alert('Nema dnevnih zadataka za resetovanje!');
            }
        }

        // Real-time preview za video
        document.getElementById('videoInput').addEventListener('input', function() {
            updateVideoPreview();
        });
    </script>
</body>
</html>